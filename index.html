<!doctype html>
<html>
    <head>
        <title>Car Model</title>
        <meta charset="utf-8"/>
    <style>
    body {
        font-family: monospace;
        font-size: 16px;
        background-color: #eee;
    }
    #mode {
        display: block;
        font-weight: bold;
    }
    </style>
    </head>
    <body>
        <table>
            <tr>
                <td>
                    <canvas width="600" height="600"></canvas>
                </td>
                <td valign="top">
                    <div>
                        Mode:
                        <span id="mode">Manual</span>
                    </div>
                </td>
            </tr>
        </table>
        <script src="geometrics.js"></script>
        <script src="shapes.js"></script>
        <script src="models.js"></script>
        <script>
var cv = document.getElementsByTagName("canvas")[0];
var cx = cv.getContext("2d");

var player1 = new Car(450, 240, Math.PI/20, "#3ff");
var player2 = new Car(490, 240, Math.PI/20, "#f3f");
var player3 = new Car(440, 300, Math.PI/17, "#ff3");
var player4 = new Car(480, 300, Math.PI/19, "#33f");
var player5 = new Car(430, 360, Math.PI/20, "#f33");
var player6 = new Car(470, 360, Math.PI/18, "#aaa");

var track1 = new Mesh("#fff");
track1.add_point([90, 100]);
track1.add_point([550, 90]);
track1.add_point([500, 480]);
track1.add_point([100, 440]);
track1.add_point([90, 100]);

var track2 = new Mesh("#fff");
track2.add_point([190, 200]);
track2.add_point([430, 201]);
track2.add_point([400, 380]);
track2.add_point([200, 370]);
track2.add_point([190, 200]);

var scene = new Group();
scene.add_mesh(track1);
scene.add_mesh(track2);
scene.add_mesh(player1.mesh);
scene.add_mesh(player2.mesh);
scene.add_mesh(player3.mesh);
scene.add_mesh(player4.mesh);
scene.add_mesh(player5.mesh);
scene.add_mesh(player6.mesh);

var manual = true;
window.onkeypress = function(e)
{
    switch (e.which)
    {
        case 119: //up (W)
        case 87:
            player1.go_forward();
            break;
        case 97:  //left (A)
        case 65:
            player1.turn_left(scene);
            break;
        case 100: //right (D)
        case 68:
            player1.turn_right(scene);
            break;
        case 115: //down (S)
        case 83:
            player1.go_backward();
            break;
        case 32:
            manual = false;
            window.setInterval(function() {
                player1.update(scene);
                player2.update(scene);
                player3.update(scene);
                player4.update(scene);
                player5.update(scene);
                player6.update(scene);
            }, 40);
            break;
    }
}

/* Render loop */
window.setInterval(function() {
    player1.move(scene);
    player2.move(scene);
    player3.move(scene);
    player4.move(scene);
    player5.move(scene);
    player6.move(scene);

    cx.fillStyle = "#444";
    cx.fillRect(0, 0, cv.width, cv.height);

    scene.render(cv);
    player1.render(cv, scene);
    player2.render(cv, scene);
    player3.render(cv, scene);
    player4.render(cv, scene);
    player5.render(cv, scene);
    player6.render(cv, scene);

    document.getElementById("mode").innerHTML =
                                        manual?"Manual":"Automatic";
}, 20);
        </script>
    </body>
</html>
