<!doctype html>
<html>
    <head>
        <title>Car Model</title>
        <meta charset="utf-8"/>
    <style>
    body {
        font-family: monospace;
        font-size: 16px;
        background-color: #eee;
    }
    .editord {
        display: block;
        font-weight: bold;
    }
    .editorc {
        margin-bottom: 10px;
    }
    </style>
    </head>
    <body>
        <table>
            <tr>
                <td>
                    <canvas width="600" height="600"></canvas>
                </td>
                <td valign="top">
                    <div class='editorc'>
                        Mode:
                        <span class="editord" id="mode">Manual</span>
                    </div>
                    <div class='editorc'>
                        Select:
                        <span class="editord" id="index">0</span>
                    </div>
                </td>
            </tr>
        </table>
        <script src="geometrics.js"></script>
        <script src="shapes.js"></script>
        <script src="models.js"></script>
        <script>
var cv = document.getElementsByTagName("canvas")[0];
var cx = cv.getContext("2d");

var racers = [
    new Car(450, 240, Math.PI/20, "#3ff"),
    new Car(490, 240, Math.PI/20, "#f3f"),
    new Car(440, 300, Math.PI/17, "#ff3"),
    new Car(480, 300, Math.PI/19, "#33f"),
    new Car(430, 360, Math.PI/20, "#f33"),
    new Car(470, 360, Math.PI/18, "#aaa")
];
var racers_i = 0;

var track1 = new Mesh("#fff");
track1.add_point([90, 100]);
track1.add_point([550, 90]);
track1.add_point([500, 480]);
track1.add_point([100, 440]);
track1.add_point([90, 100]);

var track2 = new Mesh("#fff");
track2.add_point([190, 200]);
track2.add_point([430, 201]);
track2.add_point([400, 380]);
track2.add_point([200, 370]);
track2.add_point([190, 200]);

var scene = new Group();
scene.add_mesh(track1);
scene.add_mesh(track2);
for (var i in racers)
{
    scene.add_mesh(racers[i].mesh);
}

var manual = true;
window.onkeypress = function(e)
{
    switch (e.which)
    {
        case 48:
        case 49:
        case 50:
        case 51:
        case 52:
        case 53:
        case 54:
        case 55:
        case 56:
        case 57:
            racers_i = (e.which - 48) % racers.length;
            document.getElementById("index").innerHTML = racers_i;
            break;
        case 119: //up (W)
        case 87:
            racers[racers_i].go_forward();
            break;
        case 97:  //left (A)
        case 65:
            racers[racers_i].turn_left(scene);
            break;
        case 100: //right (D)
        case 68:
            racers[racers_i].turn_right(scene);
            break;
        case 115: //down (S)
        case 83:
            racers[racers_i].go_backward();
            break;
        case 32:
            manual = !manual;
            if (manual)
            {
                for (var i in racers)
                {
                    racers[i].go_stop();
                }
            }
            window.setInterval(function() {
                if (!manual)
                {
                    for (var i in racers)
                    {
                        racers[i].update(scene);
                    }
                }
            }, 40);
            break;
        default:
            return e;
    }
    return 0;
}

/* Render loop */
window.setInterval(function() {

    cx.fillStyle = "#444";
    cx.fillRect(0, 0, cv.width, cv.height);

    scene.render(cv);
    for (var i in racers)
    {
        racers[i].move(scene);
        racers[i].render(cv, scene);
    }

    document.getElementById("mode").innerHTML =
                                        manual?"Manual":"Automatic";
}, 20);
        </script>
    </body>
</html>
